<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RealTech - Premium Laptops Store</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<!-- Supabase JS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
    }

    /* Header Styles */
    .header {
        background: #fff;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000;
    }

    .navbar {
        padding: 1rem 0;
    }

    .nav-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
    }

    .logo {
        display: flex;
        align-items: center;
        font-size: 1.5rem;
        font-weight: bold;
        color: #2c3e50;
    }

    .logo i {
        margin-right: 0.5rem;
        color: #3498db;
    }

    .nav-menu {
        display: flex;
        list-style: none;
        gap: 2rem;
    }

    .nav-link {
        text-decoration: none;
        color: #333;
        font-weight: 500;
        transition: color 0.3s;
    }

    .nav-link:hover,
    .nav-link.active {
        color: #3498db;
    }

    .hamburger {
        display: none;
        flex-direction: column;
        cursor: pointer;
    }

    .hamburger span {
        width: 25px;
        height: 3px;
        background: #333;
        margin: 3px 0;
        transition: 0.3s;
    }

    /* Hero Section */
    .hero {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 150px 0 100px;
        text-align: center;
    }

    .hero-content h1 {
        font-size: 3rem;
        margin-bottom: 1rem;
    }

    .hero-content p {
        font-size: 1.2rem;
        margin-bottom: 2rem;
    }

    .cta-button {
        display: inline-block;
        background: #3498db;
        color: white;
        padding: 12px 30px;
        text-decoration: none;
        border-radius: 5px;
        font-weight: bold;
        transition: background 0.3s;
    }

    .cta-button:hover {
        background: #2980b9;
    }

    /* Products Section */
    .products-section {
        padding: 80px 0;
        background: #f8f9fa;
    }

    .products-section h2 {
        text-align: center;
        margin-bottom: 3rem;
        font-size: 2.5rem;
        color: #2c3e50;
    }

    .filters {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
        justify-content: center;
        flex-wrap: wrap;
    }

    .filters select {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 1rem;
    }

    .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        min-height: 200px;
    }

    .product-card {
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        transition: transform 0.3s, box-shadow 0.3s;
    }

    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .product-image {
        width: 100%;
        height: 200px;
        background: linear-gradient(45deg, #f0f2f5, #e1e8ed);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        color: #667eea;
        overflow: hidden;
    }

    .product-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .product-info {
        padding: 1.5rem;
    }

    .product-name {
        font-size: 1.2rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
        color: #2c3e50;
    }

    .product-brand {
        color: #7f8c8d;
        margin-bottom: 0.5rem;
    }

    .product-price {
        font-size: 1.5rem;
        font-weight: bold;
        color: #e74c3c;
        margin-bottom: 1rem;
    }

    .product-description {
        color: #666;
        margin-bottom: 1rem;
        line-height: 1.5;
    }

    .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
        transition: background 0.3s;
        text-decoration: none;
        display: inline-block;
        text-align: center;
    }

    .btn-primary {
        background: #3498db;
        color: white;
        width: 100%;
    }

    .btn-primary:hover {
        background: #2980b9;
    }

    .btn-primary:disabled {
        background: #bdc3c7;
        cursor: not-allowed;
    }

    /* Loading states */
    .loading-grid {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 300px;
    }

    .loading {
        display: inline-block;
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .no-products {
        text-align: center;
        padding: 4rem 2rem;
        color: #7f8c8d;
    }

    .no-products i {
        font-size: 4rem;
        margin-bottom: 1rem;
        color: #bdc3c7;
    }

    /* WhatsApp floating button */
    .whatsapp-float {
        position: fixed;
        width: 60px;
        height: 60px;
        bottom: 40px;
        right: 40px;
        background-color: #25d366;
        color: white;
        border-radius: 50px;
        text-align: center;
        font-size: 30px;
        box-shadow: 2px 2px 3px #999;
        z-index: 100;
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        transition: all 0.3s;
    }

    .whatsapp-float:hover {
        background-color: #128c7e;
        transform: scale(1.1);
        color: white;
    }

    /* Footer */
    .footer {
        background: #2c3e50;
        color: white;
        text-align: center;
        padding: 2rem 0;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .hamburger {
            display: flex;
        }
        
        .nav-menu {
            position: fixed;
            left: -100%;
            top: 70px;
            flex-direction: column;
            background-color: white;
            width: 100%;
            text-align: center;
            transition: 0.3s;
            box-shadow: 0 10px 27px rgba(0,0,0,0.05);
            padding: 2rem 0;
        }
        
        .nav-menu.active {
            left: 0;
        }
        
        .hero-content h1 {
            font-size: 2rem;
        }
        
        .filters {
            flex-direction: column;
            align-items: center;
        }
    }

    /* Notification styles */
    .notification {
        position: fixed;
        top: 100px;
        right: 20px;
        background: #2ecc71;
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 5px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 1001;
        transform: translateX(100%);
        transition: transform 0.3s ease;
    }

    .notification.show {
        transform: translateX(0);
    }

    .notification.error {
        background: #e74c3c;
    }
</style>
</head>
<body>
<header class="header">
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-laptop"></i>
                <span>RealTech</span>
            </div>
            <ul class="nav-menu">
                <li><a href="#home" class="nav-link active">Home</a></li>
                <li><a href="#products" class="nav-link">Products</a></li>
                <li><a href="cart.html" class="nav-link">
                    <i class="fas fa-shopping-cart"></i>
                    Cart (<span id="cart-count">0</span>)
                </a></li>
                <li><a href="admin.html" class="nav-link">Admin</a></li>
            </ul>
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>
</header>

<main>
    <section class="hero" id="home">
        <div class="hero-content">
            <h1>Find Your Perfect Laptop</h1>
            <p>Discover premium laptops for work, gaming, and creativity</p>
            <a href="#products" class="cta-button">Shop Now</a>
        </div>
    </section>

    <section id="products" class="products-section">
        <div class="container">
            <h2>Our Laptops</h2>
            <div class="filters">
                <select id="brand-filter">
                    <option value="">All Brands</option>
                    <option value="Apple">Apple</option>
                    <option value="Dell">Dell</option>
                    <option value="HP">HP</option>
                    <option value="Lenovo">Lenovo</option>
                    <option value="ASUS">ASUS</option>
                </select>
                <select id="price-filter">
                    <option value="">All Prices</option>
                    <option value="0-1000">Under #100,000</option>
                    <option value="1000-2000">#100,000 - #200,000</option>
                    <option value="2000-3000">#200,000 - #300,000</option>
                    <option value="3000+">#300,000+</option>
                </select>
            </div>
            <div id="products-grid" class="products-grid">
                <div class="loading-grid">
                    <div class="loading"></div>
                </div>
            </div>
        </div>
    </section>
</main>

<footer class="footer">
    <div class="container">
        <p>&copy; 2024 RealTech. All rights reserved.</p>
    </div>
</footer>

<!-- WhatsApp Floating Button -->
<a href="#" id="whatsapp-float" class="whatsapp-float" title="Chat on WhatsApp">
    <i class="fab fa-whatsapp"></i>
</a>

<script>
    // Supabase configuration - REPLACE WITH YOUR CREDENTIALS
    const SUPABASE_URL = 'https://tpndsgimmvkbmfbfcrzx.supabase.co'
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRwbmRzZ2ltbXZrYm1mYmZjcnp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAyNDg4NzEsImV4cCI6MjA2NTgyNDg3MX0.C0nIeEjmQnUXPh1C4QELS-5t8vYjuXsQLnQcuFcalhw'
    
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

    // Product management and main store functionality with Supabase
    class ProductManager {
        constructor() {
            this.products = [];
            this.cart = [];
            this.sessionId = this.getSessionId();
            this.whatsappNumber = null;
            this.init();
        }

        getSessionId() {
            // Get or create a session ID for guest users
            let sessionId = localStorage.getItem('cartSessionId');
            if (!sessionId) {
                sessionId = 'guest_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('cartSessionId', sessionId);
            }
            return sessionId;
        }

        async init() {
            await this.loadProducts();
            await this.loadWhatsAppNumber();
            await this.loadCartCount();
            this.setupFilters();
            this.setupMobileMenu();
            this.setupWhatsAppFloat();
            this.setupRealTimeUpdates();
        }

        async loadProducts() {
            try {
                const { data, error } = await supabase
                    .from('products')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;
                
                this.products = data || [];
                
                // If no products in database, load default products
                if (this.products.length === 0) {
                    await this.loadDefaultProducts();
                } else {
                    this.displayProducts();
                }
            } catch (error) {
                console.error('Error loading products:', error);
                this.showError('Failed to load products. Please refresh the page.');
            }
        }

        async loadDefaultProducts() {
            const defaultProducts = [
                {
                    name: "MacBook Pro 16-inch",
                    brand: "Apple",
                    price: 2499.99,
                    image: "ðŸ’»",
                    description: "Powerful laptop for professionals with M2 Pro chip",
                    specs: ["Apple M2 Pro chip", "16GB RAM", "512GB SSD", "16-inch Retina display"]
                },
                {
                    name: "Dell XPS 13",
                    brand: "Dell",
                    price: 1299.99,
                    image: "ðŸ’»",
                    description: "Ultra-portable laptop with stunning display",
                    specs: ["Intel i7-1260P", "16GB RAM", "512GB SSD", "13.4-inch FHD+ display"]
                },
                {
                    name: "HP Spectre x360",
                    brand: "HP",
                    price: 1199.99,
                    image: "ðŸ’»",
                    description: "Versatile 2-in-1 laptop with premium design",
                    specs: ["Intel i7-1255U", "16GB RAM", "512GB SSD", "13.5-inch OLED touchscreen"]
                },
                {
                    name: "ThinkPad X1 Carbon",
                    brand: "Lenovo",
                    price: 1599.99,
                    image: "ðŸ’»",
                    description: "Business laptop with legendary durability",
                    specs: ["Intel i7-1260P", "16GB RAM", "1TB SSD", "14-inch WUXGA display"]
                },
                {
                    name: "ASUS ROG Zephyrus G14",
                    brand: "ASUS",
                    price: 1899.99,
                    image: "ðŸ’»",
                    description: "Gaming laptop with AMD Ryzen power",
                    specs: ["AMD Ryzen 9 6900HS", "32GB RAM", "1TB SSD", "RTX 3060 GPU"]
                },
                {
                    name: "MacBook Air M2",
                    brand: "Apple",
                    price: 1199.99,
                    image: "ðŸ’»",
                    description: "Lightweight laptop with incredible battery life",
                    specs: ["Apple M2 chip", "8GB RAM", "256GB SSD", "13.6-inch Liquid Retina display"]
                }
            ];

            try {
                const { data, error } = await supabase
                    .from('products')
                    .insert(defaultProducts)
                    .select();

                if (error) throw error;
                
                this.products = data || [];
                this.displayProducts();
            } catch (error) {
                console.error('Error loading default products:', error);
                this.showError('Failed to initialize products.');
            }
        }

        async loadWhatsAppNumber() {
            try {
                const { data, error } = await supabase
                    .from('settings')
                    .select('value')
                    .eq('key', 'whatsapp_number')
                    .single();

                if (data) {
                    this.whatsappNumber = data.value;
                }
            } catch (error) {
                console.error('Error loading WhatsApp number:', error);
                // Use default if not found
                this.whatsappNumber = '1234567890';
            }
        }

        async loadCartCount() {
            try {
                const { data, error } = await supabase
                    .from('cart_items')
                    .select('quantity')
                    .eq('session_id', this.sessionId);

                if (error) throw error;

                const totalItems = data.reduce((sum, item) => sum + item.quantity, 0);
                this.updateCartCount(totalItems);
            } catch (error) {
                console.error('Error loading cart count:', error);
                // Fallback to localStorage
                const cart = localStorage.getItem('laptopCart');
                const localCart = cart ? JSON.parse(cart) : [];
                const totalItems = localCart.reduce((sum, item) => sum + item.quantity, 0);
                this.updateCartCount(totalItems);
            }
        }

        setupRealTimeUpdates() {
            // Listen for real-time changes to products
            supabase
                .channel('products')
                .on('postgres_changes', 
                    { event: '*', schema: 'public', table: 'products' }, 
                    (payload) => {
                        console.log('Product change detected:', payload);
                        this.loadProducts(); // Reload products when changes occur
                    }
                )
                .subscribe();

            // Listen for cart changes
            supabase
                .channel('cart_items')
                .on('postgres_changes', 
                    { 
                        event: '*', 
                        schema: 'public', 
                        table: 'cart_items',
                        filter: `session_id=eq.${this.sessionId}`
                    }, 
                    (payload) => {
                        console.log('Cart change detected:', payload);
                        this.loadCartCount(); // Update cart count when changes occur
                    }
                )
                .subscribe();

            // Listen for settings changes (WhatsApp number)
            supabase
                .channel('settings')
                .on('postgres_changes', 
                    { event: '*', schema: 'public', table: 'settings' }, 
                    (payload) => {
                        if (payload.new?.key === 'whatsapp_number') {
                            this.whatsappNumber = payload.new.value;
                        }
                    }
                )
                .subscribe();
        }

        displayProducts(productsToShow = this.products) {
            const grid = document.getElementById('products-grid');
            if (!grid) return;

            grid.innerHTML = '';

            if (productsToShow.length === 0) {
                grid.innerHTML = `
                    <div class="no-products">
                        <i class="fas fa-laptop"></i>
                        <h3>No products found</h3>
                        <p>Try adjusting your filters or check back later.</p>
                    </div>
                `;
                return;
            }

            productsToShow.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                
                // Handle image display - check if it's base64 data or emoji/text
                const imageContent = product.image && product.image.startsWith('data:image/') 
                    ? `<img src="${product.image}" alt="${product.name}">`
                    : product.image || 'ðŸ’»';
                
                productCard.innerHTML = `
                    <div class="product-image">${imageContent}</div>
                    <div class="product-info">
                        <h3 class="product-name">${product.name}</h3>
                        <p class="product-brand">${product.brand}</p>
                        <p class="product-price">#${product.price.toFixed(2)}</p>
                        <p class="product-description">${product.description}</p>
                        <button class="btn btn-primary" onclick="productManager.addToCart(${product.id})" id="btn-${product.id}">
                            <i class="fas fa-cart-plus"></i> Add to Cart
                        </button>
                    </div>
                `;
                grid.appendChild(productCard);
            });
        }

        setupFilters() {
            const brandFilter = document.getElementById('brand-filter');
            const priceFilter = document.getElementById('price-filter');

            if (brandFilter) {
                brandFilter.addEventListener('change', () => this.filterProducts());
            }
            if (priceFilter) {
                priceFilter.addEventListener('change', () => this.filterProducts());
            }
        }

        filterProducts() {
            const brandFilter = document.getElementById('brand-filter').value;
            const priceFilter = document.getElementById('price-filter').value;

            let filteredProducts = this.products;

            if (brandFilter) {
                filteredProducts = filteredProducts.filter(product => product.brand === brandFilter);
            }

            if (priceFilter) {
                if (priceFilter === '3000+') {
                    filteredProducts = filteredProducts.filter(product => product.price >= 3000);
                } else {
                    const [min, max] = priceFilter.split('-').map(p => parseInt(p));
                    filteredProducts = filteredProducts.filter(product => 
                        product.price >= min && product.price < max
                    );
                }
            }

            this.displayProducts(filteredProducts);
        }

        async addToCart(productId) {
            const product = this.products.find(p => p.id === productId);
            if (!product) return;

            // Disable button temporarily
            const btn = document.getElementById(`btn-${productId}`);
            if (btn) {
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
            }

            try {
                // Check if item already exists in cart
                const { data: existingItem, error: checkError } = await supabase
                    .from('cart_items')
                    .select('*')
                    .eq('product_id', productId)
                    .eq('session_id', this.sessionId)
                    .single();

                if (existingItem) {
                    // Update quantity
                    const { error: updateError } = await supabase
                        .from('cart_items')
                        .update({ quantity: existingItem.quantity + 1 })
                        .eq('id', existingItem.id);

                    if (updateError) throw updateError;
                } else {
                    // Insert new item
                    const { error: insertError } = await supabase
                        .from('cart_items')
                        .insert([{
                            product_id: productId,
                            quantity: 1,
                            session_id: this.sessionId
                        }]);

                    if (insertError) throw insertError;
                }

                this.showNotification(`${product.name} added to cart!`);
                // Cart count will be updated via real-time subscription

            } catch (error) {
                console.error('Error adding to cart:', error);
                this.showNotification('Error adding to cart. Please try again.', 'error');
                
                // Fallback to localStorage
                const cart = localStorage.getItem('laptopCart');
                const localCart = cart ? JSON.parse(cart) : [];
                const existingItem = localCart.find(item => item.id === productId);
                
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    localCart.push({ ...product, quantity: 1 });
                }
                
                localStorage.setItem('laptopCart', JSON.stringify(localCart));
                const totalItems = localCart.reduce((sum, item) => sum + item.quantity, 0);
                this.updateCartCount(totalItems);
                this.showNotification(`${product.name} added to cart!`);
            } finally {
                // Re-enable button
                setTimeout(() => {
                    if (btn) {
                        btn.disabled = false;
                        btn.innerHTML = '<i class="fas fa-cart-plus"></i> Add to Cart';
                    }
                }, 1000);
            }
        }

        updateCartCount(count) {
            const cartCount = document.getElementById('cart-count');
            if (cartCount) {
                cartCount.textContent = count || 0;
            }
        }

        setupMobileMenu() {
            const hamburger = document.querySelector('.hamburger');
            const navMenu = document.querySelector('.nav-menu');

            if (hamburger && navMenu) {
                hamburger.addEventListener('click', () => {
                    navMenu.classList.toggle('active');
                });
            }
        }

        setupWhatsAppFloat() {
            const whatsappFloat = document.getElementById('whatsapp-float');
            if (whatsappFloat) {
                whatsappFloat.addEventListener('click', (e) => {
                    e.preventDefault();
                    const message = "Hello! I'm interested in your laptops. Can you help me?";
                    const whatsappUrl = `https://wa.me/${this.whatsappNumber}?text=${encodeURIComponent(message)}`;
                    window.open(whatsappUrl, '_blank');
                });
            }
        }

        showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type === 'error' ? 'error' : ''}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        showError(message) {
            this.showNotification(message, 'error');
            
            // Show error state in products grid
            const grid = document.getElementById('products-grid');
            if (grid) {
                grid.innerHTML = `
                    <div class="no-products">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Error Loading Products</h3>
                        <p>${message}</p>
                        <button class="btn btn-primary" onclick="location.reload()">
                            <i class="fas fa-refresh"></i> Retry
                        </button>
                    </div>
                `;
            }
        }
    }

    // Initialize the product manager when the page loads
    let productManager;
    document.addEventListener('DOMContentLoaded', () => {
        productManager = new ProductManager();
    });
</script>
</body>
</html>
